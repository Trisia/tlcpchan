# TLCP Channel UI 用户手册

## 目录

1. [快速入门](#1-快速入门)
2. [核心概念](#2-核心概念)
3. [应用场景配置指南](#3-应用场景配置指南)
4. [证书密钥管理](#4-证书密钥管理)
5. [系统配置与监控](#5-系统配置与监控)
6. [故障排除](#6-故障排除)
7. [最佳实践](#7-最佳实践)

---

## 1. 快速入门

### 1.1 系统概述
TLCP Channel 是一款 TLCP/TLS 双协议代理工具，支持国密协议和国际标准协议并行工作。本管理界面提供可视化的实例配置、证书管理和监控功能。

### 1.2 初始访问
- 默认访问地址：`http://localhost:20080`
- 首次登录后查看仪表板了解系统状态

### 1.3 界面概览
- 侧边导航栏：访问各个功能模块
- 主工作区：执行具体操作的区域
- 状态栏：显示系统运行状态和快捷操作

### 图片规划

| 图片编号 | 图片名称 | 描述 | 标注内容 |
|---------|---------|------|---------|
| 图1-1 | 登录界面 | TLCP Channel 管理界面登录页面 | 系统标题、版本信息 |
| 图1-2 | 仪表板概览 | 系统启动后的默认仪表板 | 实例统计卡片、健康状态、系统信息 |
| 图1-3 | 界面布局说明 | 完整界面布局标注 | 导航栏、工作区、状态栏区域 |

---

## 2. 核心概念

### 2.1 实例类型详解
- **Server**：TCP服务端代理，接收加密连接并转发到目标
- **Client**：TCP客户端代理，接收明文连接并以加密方式连接目标
- **HTTP-Server**：HTTP服务端代理，处理HTTP/HTTPS请求
- **HTTP-Client**：HTTP客户端代理，发起HTTP/HTTPS请求

### 2.2 协议选择指南
- **TLCP**：国密协议，使用SM2/SM3/SM4算法，适用于合规要求场景
- **TLS**：国际标准协议，支持RSA/ECDSA算法，适用于通用场景
- **AUTO**：自动检测协议，根据客户端握手自动选择TLCP或TLS

### 2.3 认证模式解析
- **None**：无认证，不验证证书，仅用于测试环境
- **One-way**：单向认证，验证对端证书，适用于公网服务
- **Mutual**：双向认证，双方互相验证证书，最高安全级别

### 图片规划

| 图片编号 | 图片名称 | 描述 | 标注内容 |
|---------|---------|------|---------|
| 图2-1 | 实例类型对比表 | 四种实例类型对比表格 | 类型名称、适用场景、配置要点 |
| 图2-2 | 协议选择决策树 | 帮助选择协议的决策流程图 | 决策节点、分支条件 |
| 图2-3 | 认证模式示意图 | 三种认证模式握手过程 | 握手步骤、证书交换 |

---

## 3. 应用场景配置指南（重点章节）

### 3.1 国密代理

#### 场景描述
为现有非国密应用添加 TLCP 协议支持，满足国密要求。

#### 配置要点
- 强制使用 TLCP 协议
- 配置双证书（签名证书 + 加密证书）
- 双向认证，最高安全级别
- 选择国密密码套件

#### 操作步骤
1. 进入「实例管理」页面
2. 点击「新建实例」按钮
3. 填写基本信息：
   - 实例名称：`gm-app-server`
   - 类型：`服务端代理 (server)`
   - 协议：`TLCP`
   - 认证模式：`双向认证 (mutual)`
4. 配置监听和目标地址
5. 选择预生成的 TLCP 密钥存储
6. 启用实例并创建

#### 配置示例
```yaml
name: "gm-app-server"
type: "server"
protocol: "tlcp"
listen: ":9443"
target: "legacy-app:8080"
enabled: true
tlcp:
  auth: "mutual"
  cipher-suites: ["ECC_SM4_GCM_SM3", "ECDHE_SM4_GCM_SM3"]
  curve-preferences: ["SM2"]
  keystore:
    type: "file"
    params:
      sign-cert: "keystores/server-sign.crt"
      sign-key: "keystores/server-sign.key"
      enc-cert: "keystores/server-enc.crt"
      enc-key: "keystores/server-enc.key"
```

#### 图片规划

| 图片编号 | 图片名称 | 描述 | 标注内容 |
|---------|---------|------|---------|
| 图3-1-1 | 国密代理拓扑图 | 国密合规代理网络拓扑 | 客户端、代理服务器、后端服务连接关系 |
| 图3-1-2 | 创建实例界面 | 新建实例对话框 | 类型选择、协议选择、认证模式下拉框 |
| 图3-1-3 | TLCP配置界面 | TLCP协议详细配置 | 双证书选择区域、密码套件设置 |

---

### 3.2 协议过渡网关

#### 场景描述
从 TLS 平滑过渡到 TLCP，支持新旧客户端同时连接，实现无痛迁移。

#### 配置要点
- 使用 AUTO 协议自动检测
- 同时配置 TLCP 和 TLS 证书
- 客户端透明，无需感知协议差异
- 逐步迁移策略

#### 操作步骤
1. 进入「实例管理」页面
2. 点击「新建实例」
3. 配置为：
   - 类型：`服务端代理`
   - 协议：`自动 (auto)`
4. 分别配置 TLCP 和 TLS 证书
5. 设置相同的监听和目标地址

#### 配置示例
```yaml
name: "dual-protocol-gateway"
type: "server"
protocol: "auto"
listen: ":443"
target: "backend:80"
enabled: true
tlcp:
  auth: "one-way"
  keystore:
    type: "file"
    params:
      sign-cert: "keystores/tlcp-sign.crt"
      sign-key: "keystores/tlcp-sign.key"
      enc-cert: "keystores/tlcp-enc.crt"
      enc-key: "keystores/tlcp-enc.key"
tls:
  auth: "one-way"
  keystore:
    type: "file"
    params:
      cert: "keystores/tls.crt"
      key: "keystores/tls.key"
```

#### 图片规划

| 图片编号 | 图片名称 | 描述 | 标注内容 |
|---------|---------|------|---------|
| 图3-2-1 | 协议过渡拓扑图 | 双协议网关网络拓扑 | TLCP客户端、TLS客户端、双协议网关 |
| 图3-2-2 | AUTO协议配置 | AUTO协议配置界面 | TLCP证书区域、TLS证书区域 |

---

### 3.3 安全反向代理

#### 场景描述
保护内部 Web 服务，实现访问控制、HTTP 头部修改和流量监控。

#### 配置要点
- 使用 HTTP-Server 类型
- 配置请求头和响应头修改
- 传递客户端真实 IP
- 隐藏内部服务信息

#### 操作步骤
1. 创建新实例，类型选择 `HTTP服务端 (http-server)`
2. 配置协议为 `auto` 或 `tlcp`
3. 在 HTTP 配置中添加头部修改规则
4. 设置 `X-Real-IP` 和 `X-Forwarded-For`

#### 配置示例
```yaml
name: "internal-proxy"
type: "http-server"
protocol: "auto"
listen: ":443"
target: "internal-service:3000"
enabled: true
http:
  request-headers:
    set:
      X-Real-IP: "$remote_addr"
      X-Forwarded-For: "$remote_addr"
      X-Proxy: "tlcpchan"
    remove: ["X-Powered-By"]
  response-headers:
    remove: ["Server", "X-Powered-By"]
    set:
      X-Frame-Options: "DENY"
      X-Content-Type-Options: "nosniff"
```

#### 图片规划

| 图片编号 | 图片名称 | 描述 | 标注内容 |
|---------|---------|------|---------|
| 图3-3-1 | 反向代理拓扑图 | 安全反向代理网络拓扑 | 外部访问、代理服务器、内部服务 |
| 图3-3-2 | HTTP配置界面 | HTTP头部配置界面 | 请求头修改、响应头设置 |

---

### 3.4 客户端安全连接

#### 场景描述
内网应用安全访问外部 API 服务，将明文连接转换为加密连接。

#### 配置要点
- 使用 Client 类型
- 配置服务器证书验证
- 设置合理的超时和重试策略
- 监控连接状态

#### 操作步骤
1. 创建实例，类型选择 `客户端代理 (client)`
2. 配置协议和认证模式
3. 添加目标服务器 CA 证书
4. 配置连接超时参数

#### 配置示例
```yaml
name: "secure-client-proxy"
type: "client"
protocol: "tlcp"
listen: ":8080"
target: "secure-api:443"
enabled: true
tlcp:
  auth: "mutual"
  server-ca: ["rootcerts/api-ca.crt"]
  keystore:
    type: "file"
    params:
      sign-cert: "keystores/client-sign.crt"
      sign-key: "keystores/client-sign.key"
      enc-cert: "keystores/client-enc.crt"
      enc-key: "keystores/client-enc.key"
timeout:
  dial: "5s"
  read: "60s"
  write: "60s"
  handshake: "10s"
```

#### 图片规划

| 图片编号 | 图片名称 | 描述 | 标注内容 |
|---------|---------|------|---------|
| 图3-4-1 | 客户端代理拓扑图 | 客户端代理网络拓扑 | 内网应用、客户端代理、外部服务 |
| 图3-4-2 | 客户端证书配置 | 客户端证书配置界面 | 服务器CA证书选择、客户端证书配置 |

---

## 4. 证书密钥管理

### 4.1 证书生成

#### TLCP 双证书生成
TLCP 协议需要双证书：签名证书用于身份认证，加密证书用于密钥交换。

#### TLS 单证书生成
TLS 协议使用单证书，同时用于签名和加密。

#### 根证书生成
根证书用于自建证书颁发机构，签发其他证书。

#### 操作步骤
1. 进入「密钥管理」页面
2. 点击「生成密钥」按钮
3. 选择证书类型：TLCP 或 TLS
4. 填写证书参数（名称、有效期、主题等）
5. 点击生成，系统自动创建密钥存储

### 4.2 证书管理

#### 证书上传
支持上传现有的证书和密钥文件。

#### 证书查看
查看证书详情，包括主题、颁发者、有效期、算法等。

#### 证书更新
更新过期或即将过期的证书。

### 4.3 密钥安全

#### 安全存储建议
- 使用硬件安全模块（HSM）
- 定期轮换密钥
- 限制证书访问权限

#### 证书有效期管理
- 设置证书过期提醒
- 提前准备新证书
- 平滑切换新旧证书

### 图片规划

| 图片编号 | 图片名称 | 描述 | 标注内容 |
|---------|---------|------|---------|
| 图4-1 | 密钥生成界面 | 生成密钥对话框 | 证书类型选择、参数配置区域 |
| 图4-2 | 证书管理列表 | 证书管理界面 | 证书列表、操作按钮区域 |
| 图4-3 | 证书详情查看 | 证书详细信息界面 | 证书主题、颁发者、有效期信息 |

---

## 5. 系统配置与监控

### 5.1 系统配置

#### API 服务配置
配置 API 服务监听地址和端口。

#### 日志配置
设置日志级别、日志文件路径和轮转策略。

#### 工作目录
配置证书、配置文件等的存储路径。

### 5.2 健康监控

#### 实例健康状态
查看每个实例的运行状态。

#### 系统资源监控
查看 CPU、内存使用情况。

#### 连接统计
查看连接数、流量等统计信息。

### 5.3 日志管理

#### 实时日志查看
在线查看系统运行日志。

#### 日志级别筛选
按级别（debug/info/warn/error）筛选日志。

#### 日志文件下载
下载完整的日志文件。

### 图片规划

| 图片编号 | 图片名称 | 描述 | 标注内容 |
|---------|---------|------|---------|
| 图5-1 | 系统配置界面 | 系统配置页面 | API地址配置、日志配置区域 |
| 图5-2 | 健康监控面板 | 健康状态监控面板 | 实例运行状态、系统指标 |
| 图5-3 | 日志查看界面 | 日志查看页面 | 日志级别筛选、实时刷新按钮 |

---

## 6. 故障排除

### 6.1 常见问题

#### 连接失败
- 检查监听地址和目标地址配置
- 验证证书有效性
- 查看防火墙规则

#### 证书验证错误
- 确认 CA 证书已正确配置
- 检查证书链完整性
- 验证证书有效期

#### 配置错误
- 使用配置验证功能检查
- 查看错误日志
- 对比配置模板

### 6.2 诊断工具

#### 配置验证
系统内置配置验证功能，检查配置语法和逻辑。

#### 连接测试
测试实例连接是否正常。

#### 日志分析
通过日志定位问题原因。

### 6.3 错误代码

| 错误代码 | 含义 | 解决方案 |
|---------|------|---------|
| CERT_EXPIRED | 证书过期 | 更换新证书 |
| HANDSHAKE_FAILED | 握手失败 | 检查协议和认证配置 |
| CONNECTION_REFUSED | 连接被拒绝 | 检查目标服务是否运行 |

### 图片规划

| 图片编号 | 图片名称 | 描述 | 标注内容 |
|---------|---------|------|---------|
| 图6-1 | 配置验证界面 | 配置验证功能界面 | 验证结果、错误提示 |
| 图6-2 | 错误诊断流程 | 故障诊断流程图 | 诊断步骤、检查点 |

---

## 7. 最佳实践

### 7.1 安全配置

#### 密码套件选择
- TLCP：优先使用 `ECC_SM4_GCM_SM3` 和 `ECDHE_SM4_GCM_SM3`
- TLS：优先使用前向保密密码套件

#### 证书安全管理
- 启用双向认证（mutual）
- 定期轮换证书
- 禁用不安全的证书验证跳过选项

### 7.2 性能优化

#### 缓冲区大小
根据网络条件调整缓冲区大小，默认 4096 字节。

#### 超时配置
设置合理的超时时间，避免连接挂起。

#### 会话管理
启用会话缓存和会话票据，提升握手性能。

### 7.3 高可用部署

#### 多实例部署
部署多个实例分担负载。

#### 负载均衡
使用负载均衡器分发流量。

#### 故障切换
配置健康检查和自动故障切换。

### 图片规划

| 图片编号 | 图片名称 | 描述 | 标注内容 |
|---------|---------|------|---------|
| 图7-1 | 安全配置清单 | 安全配置检查清单 | 必须配置的安全选项 |
| 图7-2 | 性能优化配置 | 性能优化配置界面 | 关键性能参数 |

---

## 附录

### A. 配置参数速查表

### B. 常见配置模板

### C. API 接口文档

### D. CLI 使用说明

---

## 截图规范

### 截图标准
- **完整界面**：每次截图包含整个浏览器窗口
- **分辨率**：1920×1080 或 1440×900
- **浏览器**：Chrome 或 Firefox 最新版本
- **主题**：系统默认主题（浅色模式）

### 标注规范
- **红色矩形框**：标注关键操作区域
- **红色箭头**：指示操作流程
- **红色文字标注**：说明重要信息
- **编号标注**：对于多个操作步骤进行编号

### 图片命名规范
```
格式：章-节-序号-描述.png

示例：
1-1-login.png
3-1-2-create-instance.png
4-3-cert-detail.png
```

---

*文档版本：1.0*  
*最后更新：2026-02-20*
